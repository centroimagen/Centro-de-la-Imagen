!function($){"use strict";function l(t,e,i){var i=i||$("#"+e+"_options_wrapper li.ptb_cmb_option").last(),n=(i.find('input[name^="'+e+'[url]"]').val(t.url),0<$("#auto_draft").length),a=i.find(".ptb_post_cmb_image"),e=i.find('input[name^="'+e+'[title]"]'),e=(!n&&$.trim(e.val())||e.val(t.title),i.find("textarea"));!n&&$.trim(e.val())||e.val(t.caption),a.css("background-image","url("+t.url+")")}$(document).on("ptb_add_metabox_gallery",function(t){return{}}).on("ptb_post_cmb_gallery_body_handle",function(a){var i=a.cmbItemBody.find(".ptb_cmb_options_wrapper");if(0===i.length)return!1;var n=i.children().first().clone();function o(t){t.preventDefault(),t.data.item.hide("blind",500,function(){$(this).remove()})}i.sortable({placeholder:"ui-state-highlight",handle:".ptb_cmb_option_sort"}),a.cmbItemBody.find(".ptb_cmb_option_add").on("click",{wrapper:i},function(t){var e=n.clone();e.appendTo(i).hide().show("blind",500),e.find('[name^="'+a.id+'"]').val(""),e.find(".ptb_post_cmb_image").removeAttr("style",""),e.find("."+a.id+"_remove").on("click",{item:e},o),t.data.wrapper.sortable("refresh")}),i.children().each(function(){var t=$(this);t.find("."+a.id+"_remove").on("click",{item:t},o)}),$(".ptb_post_cmb_item_gallery").on("click","."+a.id+"_option_wrapper .ptb_post_cmb_image",function(t){t.preventDefault();var n=$(this).closest("li");wp.media.frames.file_frame=wp.media({title:wp.media.view.l10n.editGalleryTitle,button:{text:$(this).data("uploader_button_text")},frame:"post",state:"gallery-edit",library:{type:"image"},editing:!0,multiple:!0,selection:!1}).on("update",function(t){for(var e in t.models){var i=t.models[e].attributes;0==e?l(i,a.id,n):e<=t.models.length-1&&($("#"+a.id+"_add_new").trigger("click"),setTimeout(l(i,a.id),600))}}).open()}).on("paste keyup keypress change",'input[name^="'+a.id+'[url]"][type="text"]',function(t){var e=$(this),i=e.closest("li");setTimeout(function(){i.find(".ptb_post_cmb_image").css("background-image","url("+e.val()+")")},100)})}),window.addEventListener("DOMContentLoaded",function(){$("body").on("change",'.ptb_extra_gallery_mode input[type="radio"]',function(){var t=$(this).closest(".ptb_back_active_module_content").find(".ptb_extra_gallery_columns, .ptb_extra_gallery_layout");"showcase"===$(this).val()?t.slideUp():t.slideDown()}),$(document).on("PTB.template_load",function(){$('.ptb_extra_gallery_mode input[type="radio"]:checked').trigger("change")})},{once:!0,passive:!0})}(jQuery);