var ptb_extra_geocoder;function ptb_extra_map_init(t){"use strict";function d(e,o,t){ptb_extra_geocoder=ptb_extra_geocoder||new google.maps.Geocoder;var n={};n[o]=e,ptb_extra_geocoder.geocode(n,function(e,o){"OK"!==o&&(e[0]=null),t(e[0])})}var $=jQuery;function _(e,o,t,n,a,l,s,i,r,c){n?(n.geometry.viewport?e.fitBounds(n.geometry.viewport):(e.setCenter(n.geometry.location),e.setZoom(17)),n.icon?o.setIcon({url:n.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(35,35)}):o.setIcon(),o.setPosition(c||n.geometry.location),o.setVisible(!0),r||(l=$.trim(t.val())?$.trim(t.val()).replace(/(?:\r\n|\r|\n)/gi,"<br />"):(n.address_components&&(l=[n.address_components[0]&&n.address_components[0].short_name||"",n.address_components[1]&&n.address_components[1].short_name||"",n.address_components[2]&&n.address_components[2].short_name||""].join(" ")),t.val(l),"<div><strong>"+n.name+"</strong><br>"+l)),s.setContent(l),s.open(e,o),c||i.val(n.geometry.location.lat()+", "+n.geometry.location.lng()),a.val(JSON.stringify({place:n.place_id,location:c||n.geometry.location}))):(a.val(""),i.val(""),o.setVisible(!1))}$(".ptb_post_cmb_item_map").each(function(){var e={center:new google.maps.LatLng(43.67023,-79.38676),zoom:13,streetViewControl:!1,scrollwheel:!1},o=$(this).prop("id"),a=new google.maps.Map(document.getElementById("ptb_extra_"+o+"_canvas"),e),l=document.getElementById("ptb_extra_"+o+"_location"),e=document.getElementById("ptb_extra_"+o+"_select"),s=(a.controls[google.maps.ControlPosition.TOP_LEFT].push(l),a.controls[google.maps.ControlPosition.TOP_LEFT].push(e),new google.maps.places.Autocomplete(l)),i=(s.bindTo("bounds",a),new google.maps.InfoWindow),r=new google.maps.Marker({map:a,anchorPoint:new google.maps.Point(0,-29),draggable:!0,animation:google.maps.Animation.DROP}),c=!1,g=$("#ptb_extra_"+o+"_place"),p=$("#ptb_extra_"+o+"_info"),m=$("#ptb_extra_"+o+"_lat"),o=g.val();(o=o&&$.parseJSON(o))&&(o.location?(o.location.lat||(o.location.lat=o.location[0]),o.location.lng||(o.location.lng=o.location[1]),r.setPosition({lat:o.location.lat,lng:o.location.lng}),a.setCenter({lat:o.location.lat,lng:o.location.lng}),$.trim(p.val())&&(i.setContent($.trim(p.val())),i.open(a,r)),m.val(o.location.lat+", "+o.location.lng)):o.place&&new google.maps.places.PlacesService(a).getDetails({placeId:o.place},function(e,o){o===google.maps.places.PlacesServiceStatus.OK&&(c=e,google.maps.event.trigger(s,"place_changed",t),e.formatted_address?$(l).val(e.formatted_address):$(l).val(e.name))})),google.maps.event.addListener(r,"dragend",function(){m.val(r.getPosition().lat()+", "+r.getPosition().lng()),g.val(JSON.stringify({location:{lat:r.getPosition().lat(),lng:r.getPosition().lng()}}))}),google.maps.event.addListener(s,"place_changed",function(e){i.close(),r.setVisible(!1);var o="";if(c){t=c,o=$.trim(p.val());c=!1}else{var t,n=$.trim($(l).val());if(""===n)return void _(a,r,p,"",g,o,i,m,c);if(!(t=!e&&s.getPlace())||!t.geometry)return void d(n,"address",function(e){e&&e.geometry?_(a,r,p,e,g,o,i,m,c):alert("Autocomplete's returned place contains no geometry")})}_(a,r,p,t,g,o,i,m,c)}),google.maps.event.addListener(r,"click",function(){i.open(a,r)}),google.maps.event.addDomListener(l,"keydown",e=>{13===e.keyCode&&e.preventDefault()}),m.on("change",function(){var o=$.trim($(this).val());""!==o?(o=o.split(","))[1]&&d(o={lat:parseFloat($.trim(o[0])),lng:parseFloat($.trim(o[1]))},"location",e=>{e&&e.geometry?($(l).val(e.formatted_address),_(a,r,p,e,g,"",i,m,!1,o)):alert("Autocomplete's returned place contains no geometry")}):_(a,r,p,"",g,"",i,m,!1)}),$(e).change(function(){s.setTypes([$(this).val()])}),p.keyup(function(){var e=$.trim($(this).val()).replace(/(?:\r\n|\r|\n)/gi,"<br />");i.setContent(e)})})}($=>{"use strict";$(document).on("ptb_add_metabox_map",function(e){return{}}),window.addEventListener("DOMContentLoaded",function(){0<$(".ptb_post_cmb_item_map").length&&("object"!=typeof google||"object"!=typeof google.maps||void 0===google.maps.places?("object"==typeof google&&null!==google&&"object"==typeof google.maps&&void 0===google.maps.places&&(google.maps=null),function(e,o){var t=document.createElement("script");t.type="text/javascript",o&&(t.onload=o),document.getElementsByTagName("head")[0].appendChild(t),t.async=!0,t.src=e}("//maps.googleapis.com/maps/api/js?v=3&libraries=places&callback=ptb_extra_map_init&language="+ptb.lng+"&key="+ptb.map_key)):ptb_extra_map_init())},{once:!0,passive:!0})})(jQuery);