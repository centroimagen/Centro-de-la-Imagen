!function($,p,_,t){"use strict";function f(t,e){var a=t.nextAll(),s=a.first(),t="",i=e,e=a.last();if("="===i){if(!e.is(":visible"))return;t=e.offset().left+e.width()-s.offset().left-parseFloat(s.css("padding-right"))-parseFloat(s.css("padding-left")),a.not(":first").hide(),s.data("placeholder",s.prop("placeholder")).prop("placeholder","")}else t=e.prev().width(),setTimeout(function(){"="!==i&&(a.show(),s.prop("placeholder",s.data("placeholder")))},800);s.width(t)}function h(t,e,a,s){var i={type:"container",layout:"flex",direction:"row",classes:"ptb_group_meta_items",items:[{type:"label",text:e.label,classes:"ptb_group_meta_label"}]};if(e.hide_exist?i.items[0].classes+=" ptb_meta_exist_empty":i.items.push({classes:"ptb_meta_exist",name:"ptb_"+a+"_"+t+"_exist",type:"radio",tooltip:s.meta_exists_tooltip.replace("%s",e.label),values:1,onchange:function(t){var e=$($(this)[0].$el).nextAll();this.value()?e.hide():e.show()}}),!e.hide){var l={classes:"ptb_meta_items",name:e.name,hide:!1,values:e.values||""},l=$.extend(!0,l,e);if("number"===e.type&&(l.type="textbox"),"multiselect"===e.type){for(var o in l.type="container",i.classes+=" ptb_group_meta_multiselect",l.html='<select id="'+e.name+'_select" style="width:100%;" multiple="multiple">',e.values)l.html+='<option value="'+e.values[o].value+'">'+e.values[o].text+"</option>";l.html+="</select>"}else"textbox"===e.type?i.items.push({classes:"ptb_meta_small_select",name:t+"_slike",type:"listbox",tooltip:s.meta_like_start_tooltip.replace("%s",e.label),values:[{text:"",value:""},{text:"%",value:"%"}]}):"number"===e.type&&i.items.push({classes:"ptb_meta_small_select ptb_meta_number_sign",name:t+"_from_sign",type:"listbox",values:[{text:"=",value:"="},{text:">=",value:">="},{text:">",value:">"}],onselect:function(t){f($($(this)[0].$el),this.value())}},{classes:"ptb_meta_small_input ptb_meta_placeholder ptb_meta_number_from",name:e.name+"_from",type:"textbox",value:"From"},{classes:"ptb_meta_space",type:"textbox"});"number"!==e.type?i.items.push(l):"number"===e.type&&i.items.push({classes:"ptb_meta_small_input ptb_meta_placeholder ptb_meta_number_to",name:e.name+"_to",type:"textbox",value:"To"},{classes:"ptb_meta_small_select",name:t+"_to_sign",type:"listbox",values:[{text:"<=",value:"<="},{text:"<",value:"<"}]}),"textbox"===e.type&&i.items.push({classes:"ptb_meta_small_select",name:t+"_elike",type:"listbox",tooltip:s.meta_like_end_tooltip.replace("%s",e.label),values:[{text:"",value:""},{text:"%",value:"%"}]})}return i}"undefined"!=typeof ptb_shortcodes_button&&ptb_shortcodes_button&&0<ptb_shortcodes_button.length&&tinymce.PluginManager.add("ptb",function(d,t){var e=[],b=[];for(l in ptb_shortcodes_button)if("object"==typeof ptb_shortcodes_button[l]){var a=ptb_shortcodes_button[l],s=function(c){return function(t){$.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{post_type:c,action:"ptb_ajax_get_post_type"},success:function(t){if(t){var e=[],a=t.data;for(r in a){var s={classes:"ptb_group_data_item",name:r,values:a[r].values||""},s=$.extend(!0,s,a[r]);e.push(s)}if(void 0!==t.tax&&t.tax.data){void 0!==t.tax.title&&e.push({classes:"ptb_group_taxes",fixedWidt:!0,html:'<div data-group="taxes" class="ptb_group_container">'+t.tax.title+"<i></i></div>",height:100,type:"container"});var i,l=t.tax.data;for(i in l){var o={label:l[i].label,name:l[i].name,fixedWidth:!0,tooltip:l[i].tooltip,html:'<select id="'+l[i].name+'_select"  style="width:100%;" multiple="multiple">',type:"multiselect"===l[i].type?"container":l[i].type};if("multiselect"===l[i].type){for(var n in l[i].values)o.html+='<option value="'+l[i].values[n].value+'">'+l[i].values[n].text+"</option>";o.html+="</select>"}else o=$.extend(!0,o,l[i]);e.push(o)}}if(void 0!==t.field&&t.field.data){var p={type:"container",layout:"flex",direction:"column",align:"left",spacing:15,classes:"ptb_group_field",items:[]},_=(void 0!==t.field.title&&e.push({fixedWidth:!0,html:'<div data-group="field" class="ptb_group_container">'+t.field.title+"<i></i></div>",height:100,type:"container"}),t.field.data);for(r in _)b[_[r].name+("number"===_[r].type?"_from":"")]={type:_[r].type,key:r,field:!0},p.items.push(h(r,_[r],"field",t));e.push(p)}if(void 0!==t.meta&&t.meta.data){var r,u={type:"container",layout:"flex",direction:"column",align:"left",spacing:15,classes:"ptb_group_meta",items:[]},m=(void 0!==t.meta.title&&e.push({fixedWidth:!0,html:'<div data-group="meta" class="ptb_group_container">'+t.meta.title+"<i></i></div>",height:100,type:"container"}),t.meta.data);for(r in m)b[m[r].name+("number"===m[r].type?"_from":"")]={type:m[r].type,key:r,field:!1},u.items.push(h(r,m[r],"meta",t));e.push(u)}d.windowManager.open({id:"ptb_shortcode_dialog",body:e,title:t.title,onOpen:function(){var t=$("input.mce-ptb_meta_placeholder"),e=$(".mce-ptb_meta_number_sign");0<t.length&&t.each(function(){$(this).prop("placeholder",$(this).val()).val("")}),0<e.length&&e.each(function(){f($(this),"=")})},onsubmit:function(t){var e="",a=$.event.trigger("PTB.insert_shortcode",{shortcode:e,type:c,data:t.data});if(a)e=a;else{var s,e='[ptb type="'+c+'"',i=[];for(s in t.data){var l,o,n=b[s]&&b[s].field,p=b[s]?b[s].key:"",n=n?"ptb_field_":"ptb_meta_",_=!b[s]||!t.data[n+p+"_exist"];0<$("#"+s+"_select").length&&_?(l=$("#"+s+"_select").val(),i[s]=!!l&&l.join(", ")):("string"==typeof(l=t.data[s])?l=$.trim(l):!0===l&&(l=1),b[s]?(o=!0,"textbox"!==b[s].type||l&&_?"number"===b[s].type&&($.isNumeric(l)&&_?l=parseFloat(l):o=t.data[p+"_from_sign"]=i[p+"_from_sign"]=!1,_&&$.isNumeric(t.data[n+p+"_to"])&&"="!==t.data[p+"_from_sign"]?t.data[n+p+"_to"]=parseFloat(t.data[n+p+"_to"]):(t.data[n+p+"_to"]=t.data[p+"_to_sign"]=i[n+p+"_to"]=i[p+"_to_sign"]=!1,"="===t.data[p+"_from_sign"]&&(t.data[p+"_from_sign"]=i[p+"_from_sign"]=!1))):o=t.data[p+"_slike"]=t.data[p+"_elike"]=i[p+"_slike"]=i[p+"_elike"]=!1,o&&(i[s]=l)):l&&_&&((n=-1!==s.indexOf("_children")?"_children":-1!==s.indexOf("_operator")&&"_operator")&&(n=s.replace(n,""),0<$("#ptb_tax_"+n+"_select").length)&&(!$("#ptb_tax_"+n+"_select").val()||"in"===l)||(i[s]=l)))}for(s in i)i[s]&&(e+=" "+s+'="'+i[s]+'"');e+="]"}d.insertContent(e)}})}}})}},i={text:a.name,body:{type:a.type},onclick:s(a.type),classes:a.classes};if(void 0!==a.submenu){delete i.onclick;var l,o=[];for(l in a.submenu)o.push({text:a.submenu[l].name,body:{type:a.submenu[l].type},onclick:s(a.type+"-"+a.submenu[l].type),classes:a.submenu[l].classes});i.menu=o}e.push(i)}d.addButton("ptb",{icon:"ptb-favicon",type:"menubutton",title:"PTB Shortcodes",menu:e});var n=function(){$(_).off("change",".mce-ptb_meta_number_from,.mce-ptb_meta_number_to").on("change",".mce-ptb_meta_number_from,.mce-ptb_meta_number_to",function(t){var e;$.isNumeric($(this).val())||(e=parseFloat($(this).val()),isNaN(e)&&(e=""),$(this).val(e))}),"undefined"==typeof PTB||$("body").hasClass("wp-admin")||PTB.LoadCss(ptb_assets+"css/ptb-admin.css"),$(_).on("PTB.insert_shortcode",function(t,e){if(-1<e.type.search("ptb_taxonomy-")){var a,s=[];for(a in e.data)s.push(a+'="'+e.data[a]+'"');return'[ptb_taxonomy type="'+e.type.replace("ptb_taxonomy-","")+'" '+s.join(" ")+"]"}return!1})};"complete"!==_.readyState&&p.addEventListener?p.addEventListener("load",n,{once:!0,passive:!0}):n()});let n=p.ptb_fields?JSON.parse(p.ptb_fields):null;n&&"object"==typeof n&&tinymce.PluginManager.add("ptbFields",function(e,t){let a=[];for(const[s,i]of Object.entries(n)){let t=[];for(const[l,o]of Object.entries(i.fields))t.push({text:o,onclick:function(){e.insertContent('[ptb_field name="'+l+'"]')}});a.push({text:i.name,menu:t})}e.addButton("ptbFields",{type:"menubutton",text:"PTB Fields",tooltip:"Display any PTB custom fields using a shortcode.",menu:a})})}(jQuery,window,document);