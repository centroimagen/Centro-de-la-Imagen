(($,y,w,E,N)=>{"use strict";let T;const q=function(e,t){this.$table=$(e),this.init(t)};q.prototype={$table:null,app:null,init(e){this.app=e,this.loadExtraFields(e.values),this.events(),setTimeout(()=>{this.sortableFields()},1500)},loadOrders(e,_){let p,l;try{p="string"==typeof e.field_order?JSON.parse(e.field_order):e.field_order}catch(e){}p=p||{};const t=this.$table[0].tfTag("tbody")[0],n=t.tfTag("tr"),a=[],i=E.createDocumentFragment();for(let e=0,t=n.length;e<t;++e)n[e].classList.contains("tb_no_sort")?l=n[e]:a.push(n[e]);a.sort((e,t)=>{let l,n,a,i,s=e.classList.contains("tb_contact_new_row"),o=t.classList.contains("tb_contact_new_row"),c=t=>{for(let e=_.length-1;-1<e;--e)if((_[e].label===t||_[e].id===t)&&_[e].order!==N)return _[e].order;return!1};const r=(s?e.tfClass("tb_new_field_textbox"):e.tfClass("tb_lb_option"))[0],d=(o?t.tfClass("tb_new_field_textbox"):t.tfClass("tb_lb_option"))[0];return a=s&&r.dataset.order?r.dataset.order:(l=s?r.value:r.id,l=(l=s&&""===l?r.dataset.id:l).trim(),p[l]!==N?p[l]:!!s&&c(l)),i=o&&d.dataset.order?d.dataset.order:(n=o?d.value:d.id,n=(n=o&&""===n?d.dataset.id:n).trim(),p[n]!==N?p[n]:!!o&&c(n)),a-i});for(let e=0,t=a.length;e<t;++e)i.appendChild(a[e]);i.appendChild(l);while(t.firstChild)t.lastChild.remove();t.appendChild(i)},loadExtraFields(e){let l,t=this.$table[0].tfClass("tb_no_sort")[0];try{l=(l="string"==typeof e.field_extra?JSON.parse(e.field_extra):e.field_extra)&&l.fields}catch(e){}l=l||{fields:[]};const n=E.createDocumentFragment();for(let e=0,t=l.length;e<t;++e)n.appendChild(this.addField(l[e]));t.after(n),this.loadOrders(e,l)},events(){const e=w.click;this.$table[0].tfOn(e,e=>{const t=e.target?e.target.closest(".tb_new_field_action,.tb_add_field_option,.tb_contact_value_remove,.tb_contact_field_remove,.tb_arrow"):null;if(t){"A"===e.target.tagName&&e.preventDefault(),e.stopPropagation();const l=t.classList;if(l.contains("tb_new_field_action"))t.closest(".tb_no_sort").before(this.addField({})),this.sortableFields("refresh");else if(l.contains("tb_add_field_option"))t.previousElementSibling.appendChild(this.render.getOptions([""]));else if(l.contains("tb_arrow")){const n=t.closest("li"),a=l.contains("tb_down_row")?n.nextElementSibling:n.previousElementSibling;if(!a)return;l.contains("tb_down_row")?a.after(n):a.before(n)}else if(l.contains("tb_contact_value_remove"))t.closest("li").remove();else{const i=t.closest(".tb_contact_new_row"),s=i.tfClass("tb_new_field_textbox")[0].value.trim(),o=(i.remove(),y.LightBox.el.querySelectorAll(".tb_contact_custom_tags span"));for(let e=o.length-1;-1<e;--e)o[e].textContent.trim()==="%"+s+"%"&&o[e].remove()}this.changeObject()}}).tfOn("change",e=>{const t=e.target?e.target.closest(".tb_new_field_type,.tb_contact_new_row .tb_new_field_required, .tb_new_field_icon, .tb_date_show"):null;t&&(t.classList.contains("tb_new_field_type")&&this.switchField(t),this.changeObject())}).tfOn("input",e=>{const t=e.target?e.target.closest('.tb_contact_new_row input[type="text"], .tb_contact_new_row textarea'):null;t&&this.changeObject()})},sortableFields(e){const t=this,l=this.$table.find("tbody");"refresh"===e?l.sortable("refresh"):l.sortable({items:"tr:not(.tb_no_sort)",placeholder:"ui-state-highlight",axis:"y",containment:"parent",cancel:".tb_move_opt,input,textarea,button,select,option,a",update(){t.changeObject()}}),this.sortableFieldItems(e)},sortableFieldItems(e){const t=this;this.$table.find(".control-input ul").sortable({items:"li",placeholder:"ui-state-highlight",handle:".tb_drag_opt",axis:"y",containment:"parent",cursor:"grab",cancel:"input,textarea,button,select,option,a",update(){t.changeObject()}})},render:{call(e,t){return this[t]===N?this._default(e,t):this[t].call(this,e,t)},setType(e,t){e.dataset.type=t},getText(e,t,l){const n=E.createElement(l);return"textarea"!==l&&(n.type="tel"!==l?"text":"tel"),e.value&&(e.value=e.value.replace(/\\\\n/g,"\n"),n.value=e.value.replace(/(&quot;)|(\\\\")/g,'"')),n.className="tb_new_field_value tb_field_type_text",n.placeholder=tb_contact_l10n.pl,this.setType(n,t),n},date(e,t){const l=E.createDocumentFragment(),n=ThemifyConstructor.select.render({id:"",class:"tb_date_show",options:tb_contact_l10n.date_picker_options},ThemifyConstructor);return e.show!==N&&(n.querySelector('option[value="'+e.show+'"]').selected=!0),l.appendChild(this.getText(e,"text","input")),l.appendChild(n),l},static(e,t){const l=this._default(e,"textarea");return l.placeholder=tb_contact_l10n.static_text,this.setType(l,"static"),l},upload(e,t){return E.createElement("div")},icon(e=""){const t=ThemifyConstructor.create([{type:"icon",id:"",wrap_class:"tb_disable_dc tb_new_field_icon"}]),l=t.querySelector(".themify_field_icon"),n=(l.value=e,E.createElement("span"));return n.className="tb_input_after",n.textContent=ThemifyConstructor.label.icon,t.querySelector(".tb_field").append(n),t},getOptions(c){const r=E.createDocumentFragment();for(let o in c){let e=E.createElement("li"),t=E.createElement("a"),l=E.createElement("input"),n=E.createElement("div"),a=E.createElement("div"),i=E.createElement("div"),s=E.createElement("div");a.className="tb_arrow tb_up_row",i.className="tb_drag_opt tb_no_sort tf_h",s.className="tb_arrow tb_down_row",n.className="tb_move_opt",a.title=ThemifyConstructor.label.up,s.title=ThemifyConstructor.label.down,n.append(a,i,s),l.type="text",l.className="tb_multi_option",l.value=c[o],t.className="tb_contact_value_remove tb_ui_icon_link tf_close",t.href="#",e.append(n,l,t),r.appendChild(e)}return r},_default(e,t){if("text"===t||"textarea"===t||"tel"===t||"number"===t||"email"===t||"date"===t){const s="textarea"===t?t:"input";return this.getText(e,t,s)}const l=E.createElement("ul"),n=E.createElement("a"),a=E.createDocumentFragment(),i=e.value||[""];return l.appendChild(this.getOptions(i)),n.href="#",n.className="tb_add_field_option tb_ui_icon_link",n.textContent=tb_contact_l10n.add_option,this.setType(n,t),a.append(l,n),a}},addField(e){const t=0===Object.keys(e).length,l=e.type||"text",n=E.createElement("tr"),a=E.createElement("td"),i=E.createElement("td"),s=E.createElement("input"),o=E.createElement("td"),c=E.createElement("div"),r=E.createElement("select"),d=E.createDocumentFragment(),_=E.createElement("div"),p=E.createElement("div"),b=E.createElement("label"),f=E.createElement("input"),h=E.createElement("a"),u=E.createElement("span"),m=tb_contact_l10n.types,g="tb_"+y.Helper.generateUniqueID();_.className="control-input tf_rel",p.className="tb_new_field",c.className="selectwrapper tf_rel tf_inline_b tf_vmiddle",r.className="tb_new_field_type tb_lb_option",n.className="tb_contact_new_row",s.type="text",s.className="tb_new_field_textbox",s.value=e.label===N?!0==t?tb_contact_l10n.field_name:"":e.label.replace(/&quot;/g,'"'),s.dataset.id=e.id===N?"":e.id,s.dataset.order=e.order===N?"":e.order,f.type="checkbox",f.className="tb_new_field_required",f.value="required","static"===l&&(b.style.display="none"),!0===e.required&&(f.checked=!0),o.setAttribute("colspan","2"),a.appendChild(s),n.appendChild(a);for(let t in m){let e=E.createElement("option");e.name=g,t===l&&(e.selected="selected"),e.value=t,e.textContent=m[t],d.appendChild(e)}return r.appendChild(d),c.appendChild(r),_.appendChild(this.render.call(e,l)),b.append(f,E.createTextNode(tb_contact_l10n.req)),p.append(_,b),p.append(this.render.icon(e.icon)),o.append(c,p),i.appendChild(h),h.className="tb_contact_field_remove tf_close tb_ui_icon_link",h.href="#",n.append(o,i),u.appendChild(E.createTextNode("%"+s.value+"%")),y.LightBox.el.querySelector(".tb_contact_custom_tags").appendChild(u),s.tfOn("change",function(){u.textContent="%"+this.value+"%"},{passive:!0}),n},switchField(e){const t=e.value,l=e.closest("td").tfClass("control-input")[0],n=l.closest(".tb_new_field").tfClass("tb_new_field_required")[0].parentNode;while(l.firstChild)l.lastChild.remove();l.appendChild(this.render.call({},t)),n.style.display="static"===t?"none":"","radio"!==t&&"select"!==t&&"checkbox"!==t||this.sortableFieldItems()},changeObject(e){const o=this.$table[0].tfTag("tbody")[0].tfTag("tr"),c={fields:[]},t={};for(let s=0,e=o.length;s<e;++s)if(o[s].classList.contains("tb_contact_new_row")){let n=o[s].tfClass("tb_new_field_type")[0].options[o[s].tfClass("tb_new_field_type")[0].selectedIndex].value,t=o[s].tfClass("tb_new_field_textbox")[0].value.trim(),l="static"!==n&&!0===o[s].tfClass("tb_new_field_required")[0].checked,a=o[s].tfClass("themify_field_icon")[0].value.trim(),i;switch(n){case"text":case"email":case"number":case"textarea":case"static":case"tel":case"date":i=o[s].tfClass("tb_new_field_value")[0].value.trim();break;case"radio":case"select":case"checkbox":i=[];let l=o[s].tfClass("control-input")[0].tfTag("input");for(let t=0,e=l.length;t<e;++t){let e=l[t].value.trim();""===e&&"select"!==n||i.push(e)}break}if(""!==i&&i!==N||""!==t){let e={type:n,order:s,icon:a};l&&(e.required=l),"date"===n&&(e.show=o[s].tfClass("tb_date_show")[0].value),""!==t?e.label=t.replace(/"/g,"&quot;"):e.id="ex"+s,i!==N&&""!==i&&0<i.length&&("static"===n?i=i.replace(/"/g,'\\\\"'):"text"!==n&&"textarea"!==n||(i=i.replace(/"/g,"&quot;")),"static"!==n&&"textarea"!==n||(i=i.replace(/\n/g,"\\\\n")),e.value=i),c.fields.push(e)}}else if(!o[s].classList.contains("tb_no_sort")){let e=o[s].tfClass("tb_lb_option")[0].id;t[e]=s}const l=y.LightBox.el.querySelector("#field_extra"),n=JSON.stringify(t);l.value=JSON.stringify(c),y.LightBox.el.querySelector("#field_order").value=n,this.app.settings.field_order=n,e||w.triggerEvent(l,"change")}};y.jsModuleLoaded().then(()=>{if(ThemifyConstructor.sendto_select={render(t,e){let l=e.getStyleVal("user_role");e.getStyleVal("send_to_admins")||(l="");const n=E.createDocumentFragment(),a=E.createElement("input"),i=E.createElement("select"),s=E.createElement("div"),o=E.createElement("div");a.name="send_to_admins",a.id="send_to_admins",a.type="hidden",a.value=(l,"false"),a.className="tb_lb_option",s.className="selectwrapper tf_inline_b tf_vmiddle tf_rel",i.className="tb_lb_option tf_scrollbar",i.id="user_role";for(let e in t.options){const c=E.createElement("option");c.value=e,c.text=t.options[e],c.selected=l===e,i.appendChild(c)}return o.className="themify-info-link",o.textContent=t.sr_message,i.addEventListener("change",function(){tb_app.LightBox.el.querySelector(".tb_field.mail_contact").classList.toggle("_tb_hide_binding",""!==this.value),tb_app.LightBox.el.querySelector("#sr").closest("tr").classList.toggle("_tb_hide_binding","sr"!==this.value),a.value=""===this.value?"false":"true",o.style.display="sr"===this.value?"block":"none"}),e.afterRun.push(()=>{i.dispatchEvent(new Event("change"))}),s.appendChild(i),n.appendChild(a),n.appendChild(s),n.appendChild(o),n}},ThemifyConstructor.contact_fields={render(e,a){window.top.Themify.fonts("ti-split-v");let i=E.createElement("tr");const l=E.createElement("table"),t=E.createElement("thead"),n=E.createElement("tbody"),s=E.createElement("tfoot"),o=E.createDocumentFragment(),c=e.options.head,r=e.options.body,d=e.options.foot,_=function(e,t,l){const n={id:"field_"+e,placeholder:t,type:"text"};return l&&(n.help=l),a.create([n])},p=function(e){const t=a.create([{type:"icon",id:e,after:ThemifyConstructor.label.icon}]),l=E.createElement("span");return l.className="tb_input_after",l.textContent=ThemifyConstructor.label.icon,t.querySelector(".tb_field").append(l),t},b=function(e){const t={id:"field_"+e,new_line:!0,type:"checkbox",options:[{value:"",name:"yes"}]};return"sendcopy_active"===e?t.binding={checked:{show:"field_sendcopy_subject"},not_checked:{hide:"field_sendcopy_subject"}}:"optin_active"===e&&(t.binding={checked:{show:"optin"},not_checked:{hide:"optin"}}),a.create([t])};for(let t in c){let e=E.createElement("th");"l"===t&&(e.colSpan=2),e.textContent=c[t],i.appendChild(e)}t.appendChild(i);for(let n in r){i=E.createElement("tr");for(let e in c){let t=E.createElement("td"),l=null;if("f"===e)(l=E.createElement("span")).textContent=r[n],t.appendChild(l);else if("l"===e){t.colSpan="2";let e;if((e=_(n+"_label",r[n])).appendChild(_(n+"_placeholder",tb_contact_l10n.pl)),e.appendChild(p(n+"_icon")),"recipients"===n){(l=E.createDocumentFragment()).appendChild(_(n+"_label",r[n])),l.appendChild(p(n+"_icon"));const C=a.create([{id:"sr_display",type:"select",label:tb_contact_l10n.display,options:{radio:tb_contact_l10n.radio,select:tb_contact_l10n.select},control:!1},{id:"sr",type:"builder",options:[{id:"label",type:"text",label:tb_contact_l10n.label,wrap_class:"tb_disable_dc"},{id:"email",type:"text",label:tb_contact_l10n.types.email,wrap_class:"tb_disable_dc",control:!1}]}]);l.appendChild(C)}else{var f;l="message"!==n?(g=E.createDocumentFragment(),f=b(n+"_require"),g.appendChild(e),f.querySelector(".tb_lb_option").appendChild(E.createTextNode(tb_contact_l10n.req)),g.appendChild(f),g):e}}else"sh"===e&&(l="recipients"===n?a.help(tb_contact_l10n.sr_info):b(n+"_active"));null!==l&&t.appendChild(l),i.appendChild(t)}o.appendChild(i)}i=E.createElement("tr");const h=E.createElement("td"),u=E.createElement("a"),m=E.createElement("span");u.className="tb_new_field_action",u.href="#",m.className="tf_plus_icon tf_rel",u.append(m,E.createTextNode(e.new_row)),h.setAttribute("colspan","4"),h.appendChild(u),i.className="tb_no_sort",i.appendChild(h),o.appendChild(i),n.appendChild(o);for(let n in d)if("align"!==n){i=E.createElement("tr");for(let t in c)if("sh"!==t||"send"!==n){let e=E.createElement("td"),l=null;if("f"===t)e.textContent=d[n];else if("l"===t){e.colSpan=2;let t=_(n+"_label",d[n]);if("send"===n){e.colSpan=3;var g=E.createDocumentFragment(),y=a.select.render({id:d.align.id,options:d.align.options},a);g.append(t,y,E.createTextNode(d.align.label));const v=a.create([{id:"send_icon",after:ThemifyConstructor.label.icon,type:"icon",wrap_class:"tb_disable_dc"}]),x=E.createElement("span");x.className="tb_input_after",x.textContent=ThemifyConstructor.label.icon,v.querySelector(".tb_field").append(x),g.append(v),l=g}else if("optin"===n){l=E.createDocumentFragment();let e=ThemifyConstructor.create([{type:"optin_provider",id:"optin"}]);l.append(t,e)}else l=t;g.appendChild(f)}else"sh"===t&&"send"!==n&&(l=b(n+"_active"),"captcha"===n)&&""!==tb_contact_l10n.captcha&&l.querySelector("input").tfOn("change",function(e){let t=this.closest("td").previousElementSibling;if(!0===this.checked){const l=E.createElement("div");l.className="tb_captcha_message tb_field_error_msg",l.innerHTML=tb_contact_l10n.captcha,t.appendChild(l)}else{let e=t.tfClass("tb_captcha_message")[0];e!==N&&e.parentNode.removeChild(e)}},{passive:!0});null!==l&&e.appendChild(l),"l"===t&&"sendcopy"===n&&e.appendChild(a.create([{id:"field_"+n+"_subject",after:tb_contact_l10n.sendcopy_sub,type:"text",class:"small"}])),i.appendChild(e)}o.appendChild(i)}return s.appendChild(o),l.className="contact_fields",l.append(t,n,s),w.on("tb_editing_contact_setting",e=>{const t=e.querySelector("#template");""===t.value&&(t.value=tb_contact_l10n.default_template),T=new q(l,a),w.on("themify_builder_lightbox_close",()=>{T=null},!0)},!0),l}},"visual"===y.mode){class e extends y.BaseInLineEdit{constructor(){super()}save(a,i,e,t,l,n){const s=i,o=s.closest(".builder-contact-field-extra");if(null===o)return t;{let n=-1;for(let e=a.el.tfClass("builder-contact-field-extra"),t=e.length-1;-1<t;--t)if(e[t]===o){n=t;break}if(-1!==n){const c=i.closest(".control-input");let l=-1;if(null!==c)for(let e=c.children,t=e.length-1;-1<t;--t)if(e[t].contains(i)){l=t;break}if(T){let e=y.LightBox.el.tfClass("tb_new_field_textbox")[n];e!==N&&((e=-1!==l?e.closest("tr").querySelectorAll(".control-input li")[l].tfClass("tb_multi_option")[0]:e).value=t,T.changeObject(!0))}else{const r=a.get("mod_settings"),d="string"==typeof r.field_extra?JSON.parse(r.field_extra):r.field_extra;if(d.fields&&d.fields[n]!==N){const _=d.fields[n];if(null!==c){if(!_.value||-1===l||_.value[l]===N)return!1;_.value[l]=t}else _.label=t;r.fieldExtra=d,a.set("mod_settings",r)}}}return!1}}}new e}y.Forms.registerValidator("tb_contact_recipient",e=>""!==y.LightBox.el.querySelector("#user_role").value||""!==e.value.trim()&&y.Forms.getValidator("email")(e))}),w.on("themify_builder_ready",()=>{w.requestIdleCallback(()=>{let e=window.top.document.tfId("themify-builder-lightbox-css");e=e&&e.nextElementSibling,window.top.Themify.loadCss(tb_contact_l10n.admin_css,null,tb_contact_l10n.v,e)},-1,1500)},!0,y.is_builder_ready)})(jQuery,tb_app,Themify,document,void 0);